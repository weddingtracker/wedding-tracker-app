<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invitor Dashboard</title>
    <script src="[https://cdn.tailwindcss.com](https://cdn.tailwindcss.com)"></script>
</head>
<body class="bg-gradient-to-r from-purple-500 to-indigo-600 min-h-screen flex flex-col items-center justify-center p-4">
    <div class="w-full max-w-xl text-center mb-8 text-white">
        <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight mb-2">Invitor Dashboard</h1>
        <p class="text-lg md:text-xl font-light opacity-80">Manage your guest list and send invitations.</p>
    </div>

    <div class="w-full max-w-xl bg-white bg-opacity-10 backdrop-blur-md rounded-xl shadow-2xl p-6 md:p-8 space-y-6 text-white">
        <div class="bg-white bg-opacity-5 rounded-xl p-4 md:p-6 shadow-lg space-y-4">
            <h2 class="text-2xl font-bold mb-2">Create Your Invitation</h2>
            <input type="text" id="coupleName1" class="w-full p-3 rounded-lg bg-white bg-opacity-10 placeholder-gray-200 text-white focus:outline-none focus:ring-2 focus:ring-indigo-400 transition" placeholder="Your Name">
            <input type="text" id="coupleName2" class="w-full p-3 rounded-lg bg-white bg-opacity-10 placeholder-gray-200 text-white focus:outline-none focus:ring-2 focus:ring-indigo-400 transition" placeholder="Partner's Name">
            <input type="text" id="date" class="w-full p-3 rounded-lg bg-white bg-opacity-10 placeholder-gray-200 text-white focus:outline-none focus:ring-2 focus:ring-indigo-400 transition" placeholder="Date (e.g., May 20, 2026)">
            <input type="text" id="location" class="w-full p-3 rounded-lg bg-white bg-opacity-10 placeholder-gray-200 text-white focus:outline-none focus:ring-2 focus:ring-indigo-400 transition" placeholder="Location (e.g., The Grand Ballroom)">
            <button onclick="saveInvitation()" class="w-full p-3 rounded-lg font-bold text-white bg-indigo-500 hover:bg-indigo-700 transition transform hover:scale-105">Save Invitation</button>
        </div>

        <div id="guest-list-section" class="bg-white bg-opacity-5 rounded-xl p-4 md:p-6 shadow-lg space-y-4 hidden">
            <h2 class="text-2xl font-bold mb-2">Guest List</h2>
            <div id="status-counts" class="flex space-x-2 mb-4 text-sm"></div>
            <div class="flex space-x-2">
                <input type="text" id="guestName" class="flex-grow p-3 rounded-lg bg-white bg-opacity-10 placeholder-gray-200 text-white focus:outline-none focus:ring-2 focus:ring-indigo-400 transition" placeholder="Enter guest name">
                <button onclick="addGuest()" class="p-3 rounded-lg font-bold text-white bg-indigo-500 hover:bg-indigo-700 transition transform hover:scale-105">Add</button>
            </div>
            <ul id="guests" class="space-y-2 max-h-60 overflow-y-auto custom-scrollbar"></ul>
        </div>
        
        <div id="share-link-section" class="bg-white bg-opacity-5 rounded-xl p-4 md:p-6 shadow-lg space-y-4 text-center hidden">
            <h2 class="text-2xl font-bold mb-2">Share Your Invitation Link</h2>
            <div id="shareUrl" class="p-3 rounded-lg bg-gray-900 bg-opacity-30 break-all text-sm"></div>
            <button onclick="copyToClipboard()" class="w-full p-3 rounded-lg font-bold text-white bg-green-500 hover:bg-green-700 transition transform hover:scale-105">Copy Link</button>
        </div>
    </div>
    
    <script>
        let invitorId = localStorage.getItem('invitorId');

        async function saveInvitation() {
            const coupleName1 = document.getElementById('coupleName1').value;
            const coupleName2 = document.getElementById('coupleName2').value;
            const date = document.getElementById('date').value;
            const location = document.getElementById('location').value;

            if (!coupleName1 || !coupleName2 || !date || !location) {
                alert('Please fill in all fields.');
                return;
            }

            const response = await fetch('/', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ coupleName1, coupleName2, date, location })
            });

            const data = await response.json();
            invitorId = data.invitorId;
            localStorage.setItem('invitorId', invitorId);
            showDashboard();
        }

        async function addGuest() {
            const guestName = document.getElementById('guestName').value;
            if (!guestName) return;

            await fetch('/api/rsvp', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ invitorId: invitorId, guestName, status: 'pending' })
            });

            document.getElementById('guestName').value = '';
            loadGuests();
        }

        async function loadGuests() {
            const response = await fetch(`/api/guests/${invitorId}`);
            const guests = await response.json();
            const guestsList = document.getElementById('guests');
            guestsList.innerHTML = '';
            
            const statusCounts = { coming: 0, declined: 0, pending: 0 };
            guests.forEach(guest => {
                if (statusCounts.hasOwnProperty(guest.status)) {
                    statusCounts[guest.status]++;
                }
                const li = document.createElement('li');
                li.className = 'flex items-center justify-between p-3 bg-white bg-opacity-5 rounded-lg shadow-inner';
                const statusClass = guest.status === 'coming' ? 'text-green-300' : guest.status === 'declined' ? 'text-red-300' : 'text-gray-300';
                li.innerHTML = `
                    <div>
                        <span class="font-semibold">${guest.name}</span>
                        <span class="ml-2 text-sm font-medium ${statusClass}">- ${guest.status}</span>
                    </div>
                `;
                guestsList.appendChild(li);
            });
            
            document.getElementById('status-counts').innerHTML = `
                <span class="p-2 rounded-lg bg-green-500 font-semibold">Coming: ${statusCounts.coming}</span>
                <span class="p-2 rounded-lg bg-red-500 font-semibold">Can't Come: ${statusCounts.declined}</span>
                <span class="p-2 rounded-lg bg-gray-500 font-semibold">Pending: ${statusCounts.pending}</span>
            `;
        }

        function showDashboard() {
            document.getElementById('guest-list-section').classList.remove('hidden');
            document.getElementById('share-link-section').classList.remove('hidden');
            document.getElementById('shareUrl').innerText = `${window.location.origin}/${invitorId}`;
            loadGuests();
        }

        function copyToClipboard() {
            const url = document.getElementById('shareUrl').innerText;
            navigator.clipboard.writeText(url).then(() => {
                alert('Link copied to clipboard!');
            });
        }

        if (invitorId) {
            showDashboard();
        }
    </script>
</body>
</html>
